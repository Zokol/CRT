<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>HSL DESTROYER!</title>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.css" />
	<script src="http://cdn.leafletjs.com/leaflet-0.5/leaflet.js"></script>
	<script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
	<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
	<script src="http://leaflet.github.io/Leaflet.label/leaflet.label.js"></script>
	<script src="jquery.xdomainajax.js"></script>
	<script src="jquery.csv-0.71.js"></script>
	<link rel="stylesheet" href="leaflet.awesome-markers.css">
	<script src="leaflet.awesome-markers.js"></script>
	<style type="text/css">
		#map { height:100%; width:100%; margin: -15px;}
		body {
			padding: 0;
			margin: 0;
		}

		function initmap() {
			// set up the map
			map = new L.Map('map');

			// create the tile layer with correct attribution
			var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
			var osmAttrib='Map data Â© OpenStreetMap contributors';
			var osm = new L.TileLayer(osmUrl, {minZoom: 8, maxZoom: 20, attribution: osmAttrib});

			map.locate({setView: true, maxZoom: 15});
			map.addLayer(osm);
			map.addLayer(ruokapaikat_layers);
			map.on('locationfound', onLocationFound);
			map.on('locationerror', onLocationError);

			//jquerymobile + leaflet fixes. you can try it without and see how it looks :)
			$('#map').height( $(window).height() );		
			$('#map').width( $(window).width() );
			map.invalidateSize();
			$('.ui-mobile [data-role="page"]').css("position", "relative"); 
			$('.ui-mobile [data-role="dialog"]').css("position", "relative");
			$('.ui-page').css("position", "relative");
		}

		/**
		 * If the user allows us to use their location
		 */
		function onLocationFound(e) {
			//Calculate radius
			var radius = e.accuracy / 2;
			//Where you are!
			L.marker(e.latlng, {icon: userIcon}).addTo(map).bindPopup("You are within " + radius + " meters from this point").openPopup();

			//Current position
			var place = [e.latlng.lat, e.latlng.lng]
			//Find out the closest restaurant
			getDistanceDataFromGoogle(place, ruokapaikat, google.maps.TravelMode.BICYCLING);
		}

		/**
		 * Users location is not defined or blocked  
		 */
		function onLocationError(e) {
			alert(e.message);
			// Set coordinates and zoom for the map view
			map.setView(new L.LatLng(60.457218, 22.256584),12);
			drawRestaurantMarkers(false);
		}

		$(function() {
			initmap();	

			//bind today-button click
			$("#today-btn").bind("click", function() {
				showToday();
				return false;
			});

			//bind week-button click
			$("#week-btn").bind("click", function() {
				showWeek();
				return false;
			});
		});

	</script>
</body>
</html>
